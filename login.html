<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Login - Zeitmanagement</title>
<link rel="stylesheet" href="style.css">
<style>
  body{display:flex;justify-content:center;align-items:center;height:100vh;background:var(--bg);}
  .login-panel{background:var(--panel);padding:24px;border-radius:var(--radius);box-shadow:var(--shadow);width:320px;display:flex;flex-direction:column;gap:12px;}
  .login-panel h2{margin:0;color:var(--text);}
  label{font-size:0.9rem;color:var(--muted);}
  input{padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:transparent;color:var(--text);width:100%;}
  button{padding:8px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;font-weight:500;cursor:pointer;}
  .error{color:#ff4d4f;font-size:0.9rem;height:1.2em;}
</style>
</head>
<body>
  <div class="login-panel">
    <h2>Login</h2>
    <div class="error" id="errorMsg"></div>
    <label for="username">Benutzername</label>
    <input type="text" id="username" autocomplete="username">
    <label for="password">Passwort</label>
    <input type="password" id="password" autocomplete="current-password">
    <button id="loginBtn">Einloggen</button>
  </div>

<script>
const loginBtn = document.getElementById('loginBtn');
const errorMsg = document.getElementById('errorMsg');

loginBtn.addEventListener('click', async () => {
    errorMsg.textContent = '';
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;

    if(!username || !password){
        errorMsg.textContent = 'Bitte alle Felder ausf√ºllen';
        return;
    }

    try {
        const res = await fetch('https://zeiterfassung-api.alessandrobolte.workers.dev', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ username, password })
        });

        if(!res.ok){
            const text = await res.text();
            errorMsg.textContent = text || 'Login fehlgeschlagen';
            return;
        }

        const data = await res.json();

        if(data.token){
            localStorage.setItem('token', data.token);

            // Weiterleitung nach Rolle
            if(data.role === 'admin'){
                window.location.href = 'admin.html';
            } else {
                window.location.href = 'index.html';
            }
        } else {
            errorMsg.textContent = data.message || 'Login fehlgeschlagen';
        }

    } catch(e){
        console.error(e);
        errorMsg.textContent = 'Server nicht erreichbar';
    }
});
</script>
</body>
</html>
